
            /* =================================================================== */
            /*    I. КОНФИГУРАЦИЯ И ГЛОБАЛЬНЫЕ СТИЛИ (Setup & Globals)           */
            /* =================================================================== */

            /* ----------------------------------- */
            /*         1.1. CSS Переменные         */
            /* ----------------------------------- */
            :root {
                /* Акцент оригинала: фиолетовый/пурпурный */
                --color-primary-default: #9933FF;
                --scrollbar-thumb-bg: var(--override-scrollbar-thumb-light, var(--color-border));
                --scrollbar-thumb-hover-bg: var(--color-hover-subtle, var(--color-border));
                --color-primary: var(--color-primary-default);

                --modal-backdrop-blur: 8px;

                /* Переменные для опасных действий */
                --color-red-text: #dc2626;
                --color-red-border: #fca5a5;
                --color-red-hover-bg: rgba(220, 38, 38, 0.1);

                /* Стили для подсветки текста при поиске */
                --search-highlight-text-bg-light: #fff352;
                --search-highlight-text-color-light: #333333;
                --search-highlight-text-bg-dark: #ffd700;
                --search-highlight-text-color-dark: #1a1a1a;

                /* Стили для подсветки блоков при поиске */
                --exact-match-border-color-light: #28a745;
                --exact-match-border-color-dark: #38c172;
                --element-highlight-bg-light: rgba(255, 220, 100, 0.2);
                --element-highlight-outline-light: rgba(255, 180, 50, 0.5);
                --element-highlight-bg-dark: rgba(184, 134, 11, 0.25);
                --element-highlight-outline-dark: rgba(218, 165, 32, 0.6);

                /* Стили для кастомного скроллбара */
                --scrollbar-track-color-light: rgba(0, 0, 0, 0.05);
                --scrollbar-track-color-dark: rgba(255, 255, 255, 0.05);
                --scrollbar-thumb-opacity: 0.65;
                --scrollbar-thumb-hover-opacity: 0.85;
                --scrollbar-thumb-bg: var(--override-scrollbar-thumb-light, var(--color-border));
                --scrollbar-thumb-hover-bg: var(--color-hover-subtle, var(--color-border));
                --scrollbar-thumb-bg: var(--override-scrollbar-thumb-light, var(--color-border));
                --scrollbar-thumb-hover-bg: var(--color-hover-subtle, var(--color-border));
            }

            @media (prefers-color-scheme: dark) {
                :root:not(.dark) {
                    --scrollbar-thumb-bg: var(
                        --override-scrollbar-thumb-dark,
                        rgba(255, 255, 255, 0.35)
                    );
                    --scrollbar-thumb-hover-bg: var(--color-hover-subtle, rgba(255, 255, 255, 0.5));
                    --scrollbar-track-color-light: var(
                        --override-scrollbar-track-dark,
                        rgba(255, 255, 255, 0.06)
                    );
                }
            }

            html.dark {
                --scrollbar-thumb-bg: var(
                    --override-scrollbar-thumb-dark,
                    var(--color-border-interactive)
                );
                --scrollbar-thumb-hover-bg: var(
                    --color-hover-subtle,
                    var(--color-border-interactive)
                );
            }

            /* ----------------------------------- */
            /*         1.2. Базовые стили          */
            /* ----------------------------------- */
            html {
                min-height: 100%;
                overflow-y: auto;
            }

            body {
                display: flex;
                flex-direction: column;
                min-height: 100vh;
                overflow-y: auto;
            }

            #appContent {
                flex-grow: 1;
            }

            /* =================================================================== */
            /*               II. КОМПОНЕНТЫ (Components)                         */
            /* =================================================================== */

            /* ----------------------------------- */
            /*        2.1. Модальные окна          */
            /* ----------------------------------- */
            body.modal-open {
                overflow: hidden;
            }

            #customizeUIModal .modal-inner-container {
                max-height: calc(100vh - 96px);
                max-width: min(920px, calc(100vw - 96px));
                display: flex;
                flex-direction: column;
            }
            @media (max-width: 640px) {
                #customizeUIModal .modal-inner-container {
                    max-height: calc(100vh - 64px);
                    max-width: calc(100vw - 32px);
                }
            }

            #customizeUIModal .-mx-6 {
                margin-left: 0 !important;
                margin-right: 0 !important;
            }
            #customizeUIModal .-mb-6 {
                margin-bottom: 0 !important;
            }
            #customizeUIModal .modal-inner-container .p-content.overflow-y-auto.flex-1 {
                flex: 1 1 auto;
                min-height: 0;
                overflow: auto;
            }

            div:has(> #clearClientDataBtn) {
                margin-left: 0 !important;
                margin-right: 0 !important;
                margin-bottom: 0 !important;
                border-bottom-left-radius: 0.5rem;
                border-bottom-right-radius: 0.5rem;
            }

            .modal-transition {
                transition-property: opacity, transform;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 200ms;
                opacity: 0;
                transform: scale(0.95);
            }

            .modal-visible {
                opacity: 1;
                transform: scale(1);
            }

            :is(
                    #algorithmModal,
                    #editModal,
                    #addModal,
                    #customizeUIModal,
                    #confirmClearDataModal,
                    #cibLinkModal,
                    #hotkeysModal,
                    #screenshotLightbox,
                    #screenshotViewerModal,
                    #noInnModal,
                    #addReglamentCategoryModal,
                    #foldersModal,
                    #reglamentModal,
                    #reglamentDetailModal,
                    #bookmarkModal,
                    #bookmarkDetailModal,
                    #extLinkModal,
                    #sedoFullscreenOverlay
                ) {
                pointer-events: none;
            }

            :is(
                    #algorithmModal,
                    #editModal,
                    #addModal,
                    #customizeUIModal,
                    #confirmClearDataModal,
                    #cibLinkModal,
                    #hotkeysModal,
                    #screenshotLightbox,
                    #screenshotViewerModal,
                    #noInnModal,
                    #addReglamentCategoryModal,
                    #foldersModal,
                    #reglamentModal,
                    #reglamentDetailModal,
                    #bookmarkModal,
                    #bookmarkDetailModal,
                    #extLinkModal,
                    #sedoFullscreenOverlay,
                    #extLinkCategoriesModal,

                ):not(.hidden) {
                pointer-events: auto;
            }

            :is(
                    #algorithmModal,
                    #editModal,
                    #addModal,
                    #customizeUIModal,
                    #confirmClearDataModal,
                    #cibLinkModal,
                    #hotkeysModal,
                    #screenshotLightbox,
                    #screenshotViewerModal,
                    #noInnModal,
                    #addReglamentCategoryModal,
                    #foldersModal,
                    #reglamentModal,
                    #reglamentDetailModal,
                    #bookmarkModal,
                    #bookmarkDetailModal,
                    #extLinkModal,
                    #sedoFullscreenOverlay,
                    #extLinkCategoriesModal,

                ):not(.hidden) {
                -webkit-backdrop-filter: blur(var(--modal-backdrop-blur)) !important;
                backdrop-filter: blur(var(--modal-backdrop-blur)) !important;
            }

            /* Стили для полноэкранного режима модальных окон */
            .is-fullscreen {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                max-width: none !important;
                max-height: none !important;
                z-index: 90 !important;
                padding: 0 !important;
                overflow: hidden !important;
            }

            .is-fullscreen > :is(.bg-white, .dark\:bg-gray-800) {
                border-radius: 0 !important;
                height: 100% !important;
                width: 100% !important;
                display: flex !important;
                flex-direction: column !important;
            }

            /* Обеспечиваем скроллинг контента в полноэкранном режиме */
            .is-fullscreen
                :is(
                    .modal-content-area-fullscreen-scroll,
                    #algorithmSteps,
                    #hotkeysModal .p-6.overflow-y-auto.flex-1,
                    #reglamentModal .modal-content-area,
                    #extLinkModal .modal-content-area,
                    #cibLinkModal .modal-content-area,
                    #bookmarkModal .p-content.overflow-y-auto.flex-1,
                    #bookmarkModal .modal-content-area,
                    #bookmarkDetailModal #bookmarkDetailOuterContent,
                    #addModal .p-content.overflow-y-auto.flex-1,
                    #editModal .p-content.overflow-y-auto.flex-1
                ) {
                flex-grow: 1;
                overflow-y: auto;
                min-height: 0;
            }

            .is-fullscreen .edit-step .step-desc {
                min-height: 150px;
            }

            /* ----------------------------------- */
            /*       2.2. Кастомный скроллбар      */
            /* ----------------------------------- */
            :is(
                    .custom-scrollbar,
                    html,
                    #searchResults,
                    .modal-content-area-fullscreen-scroll,
                    #algorithmSteps,
                    #hotkeysModal .p-6.overflow-y-auto.flex-1,
                    #reglamentModal .modal-content-area,
                    #reglamentDetailModal #reglamentDetailContent,
                    #extLinkModal .modal-content-area,
                    #cibLinkModal .modal-content-area,
                    #bookmarkModal .p-content.overflow-y-auto.flex-1,
                    #bookmarkDetailModal #bookmarkDetailOuterContent,
                    #addModal .p-content.overflow-y-auto.flex-1,
                    #editModal .p-content.overflow-y-auto.flex-1,
                    #customizeUIModal .p-content.overflow-y-auto.flex-1
                ) {
                scrollbar-width: thin;
                scrollbar-color: var(--scrollbar-thumb-bg) var(--scrollbar-track-color-light);
            }

            .dark
                :is(
                    .custom-scrollbar,
                    html,
                    #searchResults,
                    .modal-content-area-fullscreen-scroll,
                    #algorithmSteps,
                    #hotkeysModal .p-6.overflow-y-auto.flex-1,
                    #reglamentModal .modal-content-area,
                    #reglamentDetailModal #reglamentDetailContent,
                    #extLinkModal .modal-content-area,
                    #cibLinkModal .modal-content-area,
                    #bookmarkModal .p-content.overflow-y-auto.flex-1,
                    #bookmarkDetailModal #bookmarkDetailOuterContent,
                    #addModal .p-content.overflow-y-auto.flex-1,
                    #editModal .p-content.overflow-y-auto.flex-1,
                    #customizeUIModal .p-content.overflow-y-auto.flex-1
                ) {
                scrollbar-color: var(--scrollbar-thumb-bg) var(--scrollbar-track-color-dark);
            }

            :is(
                    .custom-scrollbar,
                    html,
                    #searchResults,
                    .modal-content-area-fullscreen-scroll,
                    #algorithmSteps,
                    #hotkeysModal .p-6.overflow-y-auto.flex-1,
                    #reglamentModal .modal-content-area,
                    #reglamentDetailModal #reglamentDetailContent,
                    #extLinkModal .modal-content-area,
                    #cibLinkModal .modal-content-area,
                    #bookmarkModal .p-content.overflow-y-auto.flex-1,
                    #bookmarkModal .modal-content-area,
                    #bookmarkDetailModal #bookmarkDetailOuterContent,
                    #addModal .p-content.overflow-y-auto.flex-1,
                    #editModal .p-content.overflow-y-auto.flex-1,
                    #customizeUIModal .p-content.overflow-y-auto.flex-1
                )::-webkit-scrollbar {
                width: 4px !important;
                height: 4px !important;
            }

            :is(
                    .custom-scrollbar,
                    html,
                    #searchResults,
                    .modal-content-area-fullscreen-scroll,
                    #algorithmSteps,
                    #hotkeysModal .p-6.overflow-y-auto.flex-1,
                    #reglamentModal .modal-content-area,
                    #reglamentDetailModal #reglamentDetailContent,
                    #extLinkModal .modal-content-area,
                    #cibLinkModal .modal-content-area,
                    #bookmarkModal .p-content.overflow-y-auto.flex-1,
                    #bookmarkDetailModal #bookmarkDetailOuterContent,
                    #addModal .p-content.overflow-y-auto.flex-1,
                    #editModal .p-content.overflow-y-auto.flex-1,
                    #customizeUIModal .p-content.overflow-y-auto.flex-1
                )::-webkit-scrollbar-track {
                background-color: var(--scrollbar-track-color-light);
                border-radius: 15px;
            }

            .dark
                :is(
                    .custom-scrollbar,
                    html,
                    #searchResults,
                    .modal-content-area-fullscreen-scroll,
                    #algorithmSteps,
                    #hotkeysModal .p-6.overflow-y-auto.flex-1,
                    #reglamentModal .modal-content-area,
                    #reglamentDetailModal #reglamentDetailContent,
                    #extLinkModal .modal-content-area,
                    #cibLinkModal .modal-content-area,
                    #bookmarkModal .p-content.overflow-y-auto.flex-1,
                    #bookmarkDetailModal #bookmarkDetailOuterContent,
                    #addModal .p-content.overflow-y-auto.flex-1,
                    #editModal .p-content.overflow-y-auto.flex-1,
                    #customizeUIModal .p-content.overflow-y-auto.flex-1
                )::-webkit-scrollbar-track {
                background-color: var(--scrollbar-track-color-dark);
            }

            :is(
                    .custom-scrollbar,
                    html,
                    #searchResults,
                    .modal-content-area-fullscreen-scroll,
                    #algorithmSteps,
                    #hotkeysModal .p-6.overflow-y-auto.flex-1,
                    #reglamentModal .modal-content-area,
                    #reglamentDetailModal #reglamentDetailContent,
                    #extLinkModal .modal-content-area,
                    #cibLinkModal .modal-content-area,
                    #bookmarkModal .p-content.overflow-y-auto.flex-1,
                    #bookmarkDetailModal #bookmarkDetailOuterContent,
                    #addModal .p-content.overflow-y-auto.flex-1,
                    #editModal .p-content.overflow-y-auto.flex-1,
                    #customizeUIModal .p-content.overflow-y-auto.flex-1
                )::-webkit-scrollbar-thumb {
                background-color: var(
                    --scrollbar-thumb-bg,
                    var(--override-scrollbar-thumb-dark, var(--color-border-interactive))
                ) !important;
                border-radius: 15px;
                border: 1px solid transparent !important;
                background-clip: content-box !important;
            }

            :is(
                    .custom-scrollbar,
                    html,
                    #searchResults,
                    .modal-content-area-fullscreen-scroll,
                    #algorithmSteps,
                    #hotkeysModal .p-6.overflow-y-auto.flex-1,
                    #reglamentModal .modal-content-area,
                    #reglamentDetailModal #reglamentDetailContent,
                    #extLinkModal .modal-content-area,
                    #cibLinkModal .modal-content-area,
                    #bookmarkModal .p-content.overflow-y-auto.flex-1,
                    #bookmarkDetailModal #bookmarkDetailOuterContent,
                    #addModal .p-content.overflow-y-auto.flex-1,
                    #editModal .p-content.overflow-y-auto.flex-1,
                    #customizeUIModal .p-content.overflow-y-auto.flex-1
                )::-webkit-scrollbar-thumb:hover {
                background-color: var(
                    --scrollbar-thumb-hover-bg,
                    var(
                        --color-hover-subtle,
                        var(--override-scrollbar-thumb-dark, var(--color-border))
                    )
                ) !important;
            }

            :is(
                    .custom-scrollbar,
                    html,
                    #searchResults,
                    .modal-content-area-fullscreen-scroll,
                    #algorithmSteps,
                    #hotkeysModal .p-6.overflow-y-auto.flex-1,
                    #reglamentModal .modal-content-area,
                    #reglamentDetailModal #reglamentDetailContent,
                    #extLinkModal .modal-content-area,
                    #cibLinkModal .modal-content-area,
                    #bookmarkModal .p-content.overflow-y-auto.flex-1,
                    #bookmarkDetailModal #bookmarkDetailOuterContent,
                    #addModal .p-content.overflow-y-auto.flex-1,
                    #editModal .p-content.overflow-y-auto.flex-1,
                    #customizeUIModal .p-content.overflow-y-auto.flex-1
                )::-webkit-scrollbar-corner {
                background: transparent;
            }

            #important-notifications-container.custom-scrollbar::-webkit-scrollbar {
                width: 8px;
            }

            #important-notifications-container.custom-scrollbar::-webkit-scrollbar-track {
                background: rgba(0, 0, 0, 0.1);
                border-radius: 4px;
            }

            #important-notifications-container.custom-scrollbar::-webkit-scrollbar-thumb {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 4px;
            }

            #important-notifications-container.custom-scrollbar::-webkit-scrollbar-thumb:hover {
                background: rgba(0, 0, 0, 0.5);
            }

            .dark #important-notifications-container.custom-scrollbar::-webkit-scrollbar-track {
                background: rgba(255, 255, 255, 0.05);
            }

            .dark #important-notifications-container.custom-scrollbar::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.15);
            }

            .dark
                #important-notifications-container.custom-scrollbar::-webkit-scrollbar-thumb:hover {
                background: rgba(255, 255, 255, 0.25);
            }

            /* ----------------------------------- */
            /*             2.3. Табы               */
            /* ----------------------------------- */
            /* Контейнер навигационной панели - только разделительная линия внизу */
            #appContent > div.mb-3.border-b {
                background-color: transparent !important;
                border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
                padding-left: 0;
                padding-right: 0;
                margin-left: 0;
                margin-right: 0;
            }

            /* Навигационная панель - прозрачный фон */
            #appContent > div.mb-3.border-b > nav {
                background-color: transparent !important;
            }

            .tab-btn {
                transition: color 0.2s ease-in-out, border-color 0.2s ease-in-out;
                position: relative;
                color: #B0B0B0 !important;
            }

            .tab-btn i,
            .tab-btn svg {
                color: #B0B0B0 !important;
            }

            #clientNotes.custom-scrollbar::-webkit-scrollbar {
                width: 8px !important;
            }
            #clientNotes.custom-scrollbar::-webkit-scrollbar-thumb {
                border-width: 1px;
            }

            .tab-btn.tab-active {
                color: #9955FF !important;
                border-bottom: 2px solid #9955FF !important;
                border-bottom-color: #9955FF !important;
            }

            .tab-btn.tab-active > * {
                color: #9955FF !important;
            }

            .tab-btn.tab-active i,
            .tab-btn.tab-active svg {
                color: #9955FF !important;
            }

            #moreTabsDropdown a,
            #moreTabsDropdown .overflow-dropdown-item {
                text-decoration: none !important;
            }

            #moreTabsDropdown a:hover {
                text-decoration: none !important;
            }

            #appContent #moreTabsDropdown a,
            #appContent #moreTabsDropdown .overflow-dropdown-item {
                text-decoration: none !important;
            }
            #appContent #moreTabsDropdown a:hover {
                text-decoration: none !important;
            }

            .tab-btn:hover:not(.tab-active) {
                color: #B0B0B0 !important;
            }

            .tab-btn:hover:not(.tab-active) i,
            .tab-btn:hover:not(.tab-active) svg {
                color: #B0B0B0 !important;
            }

            .tab-btn.tab-active:hover {
                color: #9955FF !important;
                border-bottom-color: #9955FF !important;
            }

            .tab-btn.tab-active:hover i,
            .tab-btn.tab-active:hover svg {
                color: #9955FF !important;
            }

            .tab-btn.tab-active:hover::before {
                transform: scaleY(0);
                opacity: 0;
                transition: none;
            }

            @media (min-width: 640px) {
                .tab-btn i {
                    margin-right: 0.35rem;
                }
            }

            .tab-content {
                transition: opacity 200ms ease-in-out;
            }

            .tab-content.is-hiding {
                opacity: 0;
            }

            :is(
                    #mainTab,
                    #programTab,
                    #linksTab,
                    #extLinksTab,
                    #skziTab,
                    #lk1cTab,
                    #webRegTab,
                    #reglamentsTab,
                    #bookmarksTab,
                    #sedoTypesTab
                ) {
                padding-left: 0.4rem;
                padding-right: 0.4rem;
            }

            /* ----------------------------------- */
            /*      2.4. Результаты поиска         */
            /* ----------------------------------- */
            #searchResults {
                transition: opacity 150ms ease-out, transform 150ms ease-out;
                opacity: 0;
                transform: translateY(-10px);
                pointer-events: none;
            }

            #searchResults:not(.hidden) {
                opacity: 1;
                transform: translateY(0);
                pointer-events: auto;
            }

            /* Подсветка точного совпадения */
            .exact-match-highlight {
                border-left: 4px solid var(--exact-match-border-color-light) !important;
                padding-left: calc(0.75rem - 4px);
                background-color: transparent !important;
            }

            .dark .exact-match-highlight,
            .dark .exact-match-highlight-dark {
                border-left-color: var(--exact-match-border-color-dark) !important;
            }

            .exact-match-highlight:hover {
                background-color: rgba(0, 0, 0, 0.03) !important;
            }

            .dark .exact-match-highlight:hover {
                background-color: rgba(255, 255, 255, 0.04) !important;
            }

            /* Активная подсветка элемента */
            .search-highlight-active {
                background-color: var(--element-highlight-bg-light) !important;
                outline: 2px solid var(--element-highlight-outline-light) !important;
                outline-offset: -2px;
                transition: background-color 0.3s ease-out, outline-color 0.3s ease-out;
                position: relative;
                z-index: 1;
            }

            .dark .search-highlight-active {
                background-color: var(--element-highlight-bg-dark) !important;
                outline-color: var(--element-highlight-outline-dark) !important;
            }

            /* Подсветка искомого текста */
            .search-term-highlight,
            mark {
                background-color: var(--search-highlight-text-bg-light);
                color: var(--search-highlight-text-color-light);
                padding: 0.08em 0.4em;
                border-radius: 0.15em;
                font-weight: 600;
                box-shadow: none;
            }

            .dark .search-term-highlight,
            .dark mark {
                background-color: var(--search-highlight-text-bg-dark);
                color: var(--search-highlight-text-color-dark);
            }

            .highlight-search-result-textarea {
                transition: box-shadow 0.3s ease-in-out;
                box-shadow: 0 0 8px 2px var(--color-primary, var(--color-primary-default));
            }

            /* ----------------------------------- */
            /*      2.5. Сортируемые списки        */
            /* ----------------------------------- */
            .my-sortable-ghost {
                background-color: #d1d5db;
                opacity: 0.75;
                border-radius: 0.375rem;
            }

            .dark .my-sortable-ghost {
                background-color: #4b5563;
            }

            .sortable-ghost {
                opacity: 0.4;
                background-color: #e0e7ff;
                border: 2px dashed var(--color-primary, #9333ea);
            }

            .sortable-drag {
                opacity: 0.95;
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
                transform: scale(1.02);
                cursor: grabbing;
            }

            .step-drag-handle {
                touch-action: none;
            }

            /* Сворачивание шагов */
            .edit-step .step-body {
                overflow: hidden;
                transition: max-height 0.35s ease-in-out, opacity 0.3s ease-in-out,
                    padding-top 0.35s ease-in-out, padding-bottom 0.35s ease-in-out,
                    margin-top 0.35s ease-in-out, border-top-width 0.35s ease-in-out;
                max-height: 2000px;
                opacity: 1;
                padding-top: 0.5rem;
            }

            .edit-step .step-toggle-icon {
                transition: transform 0.3s ease-in-out;
            }

            .edit-step.is-collapsed .step-body {
                max-height: 0;
                opacity: 0;
                padding-top: 0;
                padding-bottom: 0;
                margin-top: 0;
            }

            .edit-step.is-collapsed .step-toggle-icon {
                transform: rotate(-90deg);
            }

            .step-title-preview {
                pointer-events: none;
            }

            .algorithm-step.collapsible .collapsible-body {
                overflow: hidden;
                transition: max-height 0.35s cubic-bezier(0.22, 0.61, 0.36, 1),
                    opacity 0.3s ease-in-out, padding-top 0.35s ease-in-out,
                    padding-bottom 0.35s ease-in-out, margin-top 0.35s ease-in-out;
                max-height: 2000px;
                opacity: 1;
            }
            .algorithm-step.collapsible.is-collapsed .collapsible-body {
                max-height: 0;
                opacity: 0;
                padding-top: 0;
                padding-bottom: 0;
                margin-top: 0;
            }
            .algorithm-step.collapsible h3 {
                cursor: pointer;
            }

            /* ----------------------------------- */
            /*         2.6. Color Picker           */
            /* ----------------------------------- */
            .color-swatch.ring-primary {
                --tw-ring-color: var(--color-primary, var(--color-primary-default));
            }

            :is(#hue-handle, #saturation-handle, #brightness-handle) {
                box-sizing: border-box;
                z-index: 10;
            }

            #color-preview-swatch {
                background-color: var(--color-primary, #9333ea);
            }

            #hue-slider-gradient {
                background: linear-gradient(
                    to right,
                    red 0%,
                    #ff0 17%,
                    lime 33%,
                    cyan 50%,
                    blue 67%,
                    #f0f 83%,
                    red 100%
                );
            }

            :is(#saturation-slider-gradient, #brightness-slider-gradient) {
                transition: background 0.1s ease-out;
            }

            /* ----------------------------------- */
            /*           2.7. Лайтбокс             */
            /* ----------------------------------- */
            #screenshotLightbox img {
                box-shadow: 0 0 25px rgba(0, 0, 0, 0.5);
            }

            /* ----------------------------------- */
            /*      2.8. Прочие компоненты         */
            /* ----------------------------------- */
            .reglament-item,
            .cib-link-item {
                cursor: pointer !important;
            }

            /* Таймер */
            .timer-segment {
                display: inline-block;
                min-width: 2ch;
                text-align: center;
                padding: 0.5rem;
                border-radius: 3px;
                cursor: pointer;
                transition: background-color 0.2s;
                vertical-align: baseline;
            }

            .timer-colon {
                display: inline-block;
                padding: 0 0.1ch;
                vertical-align: baseline;
                user-select: none;
            }

            .timer-segment:hover,
            .timer-segment:focus {
                background-color: rgba(0, 0, 0, 0.1);
            }

            .dark .timer-segment:hover,
            .dark .timer-segment:focus {
                background-color: rgba(255, 255, 255, 0.1);
            }

            input.timer-input-active {
                text-align: center;
                border: 1px solid var(--color-primary, #5d5cde);
                border-radius: 3px;
                padding: 0;
                min-width: 2ch;
                width: 2.1ch;
                box-sizing: border-box;
                background-color: var(--input-bg-color, #fff);
                color: var(--input-text-color, #000);
                vertical-align: baseline;
            }

            .dark input.timer-input-active {
                background-color: var(--input-bg-color-dark, #374151);
                color: var(--input-text-color-dark, #e5e7eb);
            }

            /* =================================================================== */
            /*              III. ДВИЖОК ТЕМИЗАЦИИ (Theming Engine)               */
            /* =================================================================== */

            /* ---------------------------------------------------- */
            /*      3.1. Адаптивная семантическая палитра           */
            /* ---------------------------------------------------- */
            /* Эти переменные используются стандартными темами и служат основой для кастомных */
            :root {
                /* --- DEFAULT LIGHT --- */
                --default-text-primary-light: #111827;
                --default-text-secondary-light: #4b5563;
                --default-text-placeholder-light: #9ca3af;
                --default-background-light: #f9fafb;
                --default-surface-1-light: #f3f4f6;
                --default-surface-2-light: #ffffff;
                --default-border-light: #d1d5db;
                --default-border-interactive-light: #d1d5db;
                --default-input-bg-light: #f9fafb;
                --default-hover-subtle-light: rgba(0, 0, 0, 0.055);

                /* --- USER OVERRIDES (LIGHT) — выставляются из JS при кастомизации --- */
                /* пример: document.documentElement.style.setProperty('--override-surface-1-light', '#ededed'); */
                /* по умолчанию не заданы, срабатывает fallback на default */

                /* --- FINAL TOKENS (LIGHT) --- */
                --color-text-primary: var(
                    --override-text-primary-light,
                    var(--default-text-primary-light)
                );
                --color-text-secondary: var(
                    --override-text-secondary-light,
                    var(--default-text-secondary-light)
                );
                --color-text-placeholder: var(
                    --override-text-placeholder-light,
                    var(--default-text-placeholder-light)
                );
                --color-background: var(
                    --override-background-light,
                    var(--default-background-light)
                );
                --color-surface-1: var(--override-surface-1-light, var(--default-surface-1-light));
                --color-surface-2: var(--override-surface-2-light, var(--default-surface-2-light));
                --color-border: var(--override-border-light, var(--default-border-light));
                --color-border-interactive: var(
                    --override-border-interactive-light,
                    var(--default-border-interactive-light)
                );
                --color-input-bg: var(--override-input-bg-light, var(--default-input-bg-light));
                --color-hover-subtle: var(
                    --override-hover-light,
                    var(--default-hover-subtle-light)
                );
            }

            .dark {
                /* --- DEFAULT DARK (палитра по скрину оригинала) --- */
                --default-text-primary-dark: #ffffff;
                --default-text-secondary-dark: #B0B0B0;
                --default-text-placeholder-dark: #B0B0B0;
                --default-background-dark: #1C1C30;
                --default-surface-1-dark: #27273F;
                --default-surface-2-dark: #363653;
                --default-border-dark: #3a3a52;
                --default-border-interactive-dark: #3a3a52;
                --default-input-bg-dark: #2F2F4A;
                --default-hover-subtle-dark: rgba(255, 255, 255, 0.1);

                /* --- USER OVERRIDES (DARK) --- */
                /* пример: document.documentElement.style.setProperty('--override-surface-1-dark', '#263140'); */

                /* --- FINAL TOKENS (DARK) --- */
                --color-text-primary: var(
                    --override-text-primary-dark,
                    var(--default-text-primary-dark)
                );
                --color-text-secondary: var(
                    --override-text-secondary-dark,
                    var(--default-text-secondary-dark)
                );
                --color-text-placeholder: var(
                    --override-text-placeholder-dark,
                    var(--default-text-placeholder-dark)
                );
                --color-background: var(--override-background-dark, var(--default-background-dark));
                --color-surface-1: var(--override-surface-1-dark, var(--default-surface-1-dark));
                --color-surface-2: var(--override-surface-2-dark, var(--default-surface-2-dark));
                --color-border: var(--override-border-dark, var(--default-border-dark));
                --color-border-interactive: var(
                    --override-border-interactive-dark,
                    var(--default-border-interactive-dark)
                );
                --color-input-bg: var(--override-input-bg-dark, var(--default-input-bg-dark));
                --color-hover-subtle: var(--override-hover-dark, var(--default-hover-subtle-dark));
            }

            /* --- Оригинал: тёмная тема под скрин --- */
            html.dark body {
                background-color: #1C1C30 !important;
                color: #ffffff !important;
            }
            html.dark #appContent .dark\:bg-gray-800 {
                background-color: #27273F !important;
            }
            html.dark #appContent .dark\:bg-gray-700 {
                background-color: #363653 !important;
            }
            html.dark header {
                background-color: #1C1C30 !important;
            }
            html.dark header h1:not(.text-primary) {
                color: #ffffff !important;
            }
            /* Переопределяем цвет для заголовка Copilot с классом text-primary */
            html.dark header h1.text-primary {
                color: var(--color-primary) !important;
            }
            html.dark #appSlogan:not(.text-primary) {
                color: #B0B0B0 !important;
            }
            html.dark #appSlogan.text-primary {
                color: var(--color-primary) !important;
            }
            html.dark header button i,
            html.dark header .text-gray-500,
            html.dark header .dark\:text-gray-400,
            html.dark #timerDisplay {
                color: #ffffff !important;
            }
            html.dark #appContent > div.mb-3.border-b {
                background-color: transparent !important;
                border-bottom-color: rgba(255, 255, 255, 0.2) !important;
            }
            html.dark #appContent > div.mb-3.border-b > nav {
                background-color: transparent !important;
            }
            html.dark .tab-btn {
                color: #B0B0B0 !important;
            }
            html.dark .tab-btn i,
            html.dark .tab-btn svg {
                color: #B0B0B0 !important;
            }
            html.dark .tab-btn.tab-active {
                background-color: transparent !important;
                color: #9955FF !important;
                border-bottom: 2px solid #9955FF !important;
                border-bottom-color: #9955FF !important;
            }
            html.dark .tab-btn.tab-active i,
            html.dark .tab-btn.tab-active svg {
                color: #9955FF !important;
            }
            
            html.dark .tab-btn:hover:not(.tab-active) {
                color: #B0B0B0 !important;
            }

            html.dark .tab-btn:hover:not(.tab-active) i,
            html.dark .tab-btn:hover:not(.tab-active) svg {
                color: #B0B0B0 !important;
            }

            html.dark .tab-btn.tab-active:hover {
                color: #9955FF !important;
                border-bottom-color: #9955FF !important;
            }

            html.dark .tab-btn.tab-active:hover i,
            html.dark .tab-btn.tab-active:hover svg {
                color: #9955FF !important;
            }
            html.dark #appContent a {
                color: #00BFFF !important;
            }
            html.dark #appContent a:hover {
                color: #40d4ff !important;
            }
            html.dark #clearClientDataBtn {
                background-color: #363653 !important;
                border: 1px solid #3a3a52 !important;
                color: #ffffff !important;
            }
            html.dark #clearClientDataBtn:hover {
                background-color: #3C3C56 !important;
            }
            html.dark #clearClientDataBtn > * {
                color: #ffffff !important;
            }
            html.dark #appContent input,
            html.dark #appContent textarea,
            html.dark #appContent select {
                background-color: #2F2F4A !important;
                border-color: #3a3a52 !important;
                color: #ffffff !important;
            }
            html.dark #searchInput {
                background-color: #2F2F4A !important;
                border-color: #3a3a52 !important;
                color: #ffffff !important;
            }
            html.dark #searchInput::placeholder {
                color: #B0B0B0 !important;
            }
            html.dark #searchResults {
                background-color: #363653 !important;
                border-color: #3a3a52 !important;
            }
            html.dark #moreTabsDropdown {
                background-color: #363653 !important;
                border-color: #3a3a52 !important;
            }
            html.dark #appContent h1:not(.text-primary),
            html.dark #appContent h2,
            html.dark #appContent h3,
            html.dark #appContent h4,
            html.dark #appContent .font-bold:not(.text-primary) {
                color: #ffffff !important;
            }
            html.dark #appContent .text-gray-600,
            html.dark #appContent .text-gray-500,
            html.dark #appContent .dark\:text-gray-400,
            html.dark #appContent .dark\:text-gray-300 {
                color: #B0B0B0 !important;
            }

            /* --- ГЛОБАЛЬНАЯ НОРМАЛИЗАЦИЯ НЕЙТРАЛЬНЫХ HOVER (всегда) --- */
            /* 1) Обычные hover:* */
            :where(
                    .hover\:bg-gray-50,
                    .hover\:bg-gray-100,
                    .hover\:bg-gray-200,
                    .hover\:bg-gray-300,
                    .hover\:bg-gray-400,
                    .hover\:bg-gray-500,
                    .hover\:bg-gray-600,
                    .hover\:bg-gray-700,
                    .hover\:bg-gray-700\/50,
                    .hover\:bg-gray-800\/50,
                    .hover\:bg-slate-700,
                    .hover\:bg-white\/10,
                    .hover\:bg-black\/10,
                    .dark\:hover\:bg-gray-500,
                    .dark\:hover\:bg-gray-600,
                    .dark\:hover\:bg-gray-700,
                    .dark\:hover\:bg-gray-700\/50,
                    .dark\:hover\:bg-gray-800\/50,
                    .dark\:hover\:bg-slate-700,
                    .dark\:hover\:bg-white\/10
                ):hover {
                background-color: var(--color-hover-subtle) !important;
            }
            /* 2) group-hover:* */
            .group:hover
                :where(
                    .group-hover\:bg-gray-50,
                    .group-hover\:bg-gray-100,
                    .group-hover\:bg-gray-200,
                    .group-hover\:bg-gray-700,
                    .group-hover\:bg-gray-800\/50,
                    .group-hover\:bg-slate-700,
                    .group-hover\:bg-white\/10,
                    .group-hover\:bg-black\/10,
                    .dark\:group-hover\:bg-gray-700,
                    .dark\:group-hover\:bg-gray-800\/50,
                    .dark\:group-hover\:bg-slate-700,
                    .dark\:group-hover\:bg-white\/10
                ) {
                background-color: var(--color-hover-subtle) !important;
            }

            /* ----------------------------------------------------------- */
            /*      3.2. Глобальные переопределения для кастомной темы     */
            /* ----------------------------------------------------------- */
            /* Этот блок активируется JS через класс .custom-background-active на body. */

            /* --- ОСНОВНОЙ ФОН И ТЕКСТ --- */
            body.custom-background-active .tab-btn.tab-active,
            .tab-btn.tab-active {
                color: #9955FF !important;
                border-bottom: 2px solid #9955FF !important;
            }
            body.custom-background-active .tab-btn.tab-active > *,
            .tab-btn.tab-active > * {
                color: #9955FF !important;
            }
            .tab-btn.tab-active i,
            .tab-btn.tab-active svg {
                color: #9955FF !important;
            }

            #appContent #moreTabsDropdown a,
            #appContent #moreTabsDropdown .overflow-dropdown-item {
                text-decoration: none !important;
            }
            #appContent #moreTabsDropdown a:hover {
                text-decoration: none !important;
            }

            #showFavoritesHeaderBtn,
            #timerToggleButton,
            #timerResetButton,
            #timerDecreaseButton,
            #timerIncreaseButton,
            #themeToggle,
            #clearSearchInputBtn,
            #customizeUIBtn,
            #exportDataBtn,
            #importDataBtn,
            #forceReloadBtn,
            #showHotkeysBtn {
                color: var(--color-primary) !important;
            }
            #showFavoritesHeaderBtn i,
            #timerToggleButton i,
            #timerResetButton i,
            #timerDecreaseButton i,
            #timerIncreaseButton i,
            #themeToggle i,
            #clearSearchInputBtn i,
            #customizeUIBtn i,
            #exportDataBtn i,
            #importDataBtn i,
            #forceReloadBtn i,
            #showHotkeysBtn i {
                color: var(--color-primary) !important;
            }

            #appSlogan {
                color: var(--color-primary) !important;
            }

            body.custom-background-active #clearClientDataBtn {
                background-color: var(--color-surface-2) !important;
                border: 1px solid var(--color-border) !important;
                color: var(--color-text-primary) !important;
            }

            #editMainBtn,
            #editMainBtn > * {
                background-color: var(--color-primary) !important;
                color: var(--color-text-primary) !important;
            }

            body.custom-background-active {
                color: var(--color-text-primary) !important;
                background-color: var(--color-background) !important;
            }

            body.custom-background-active
                :is(
                    h1:not(.text-primary),
                    h2,
                    h3,
                    h4,
                    h5,
                    h6,
                    p:not(.text-primary),
                    span:not(.text-primary),
                    a,
                    button,
                    li,
                    dt,
                    dd,
                    strong,
                    em,
                    small,
                    mark,
                    blockquote,
                    code,
                    kbd,
                    pre,
                    .text-gray-900,
                    .text-gray-800,
                    .text-gray-700,
                    .text-gray-600,
                    .dark\:text-gray-100,
                    .dark\:text-gray-200,
                    .dark\:text-gray-300
                ) {
                color: var(--color-text-primary) !important;
            }

            body.custom-background-active
                :is(.text-gray-600, .text-gray-500, .dark\:text-gray-300, .dark\:text-gray-400) {
                color: var(--color-text-secondary) !important;
            }

            /* --- ФОНЫ И ПОВЕРХНОСТИ (КОРРЕКТНАЯ ДВУХСЛОЙНАЯ СИСТЕМА) --- */
            /* --- СЛОЙ 1: Подложки, заголовки и менее важные фоны --- */
            body.custom-background-active
                :is(
                    .bg-gray-100,
                    .bg-gray-50,
                    .bg-gray-200,
                    .dark\:bg-slate-600,
                    .dark\:bg-gray-700,
                    .dark\:bg-gray-700\/50,
                    .dark\:bg-gray-700\/60,
                    .dark\:bg-gray-800,
                    #timerDisplay,
                    .cib-link-item code,
                    .edit-step .step-header,
                    .bg-gray-50.dark\:bg-gray-700,
                    #addModal .bg-gray-100.dark\:bg-gray-700,
                    #editModal .bg-gray-50.dark\:bg-gray-800,
                    #sedoFullscreenContent .bg-gray-50
                ) {
                background-color: var(--color-surface-1) !important;
            }

            /* --- СЛОЙ 2: Карточки, модальные окна, выпадающие меню (основной контент) --- */
            /* Для светлых и темных тем: используется семантическая переменная для основного контента. */
            body.custom-background-active
                :is(
                    .bg-white,
                    .dark\:bg-slate-800,
                    #blacklistTableContainer,
                    .google-doc-table > thead,
                    #moreTabsDropdown,
                    .tab-content > .p-4,
                    button.bg-gray-200,
                    button.bg-gray-300,
                    .modal-inner-container,
                    #algorithmModal .bg-white.dark\:bg-gray-800,
                    #addModal .bg-white.dark\:bg-gray-800,
                    #editModal .bg-white.dark\:bg-gray-800,
                    #customizeUIModal .bg-white.dark\:bg-gray-800,
                    #confirmClearDataModal .bg-white.dark\:bg-gray-800,
                    #cibLinkModal .bg-white.dark\:bg-gray-800,
                    #hotkeysModal .bg-white.dark\:bg-gray-800,
                    #noInnModal .bg-white.dark\:bg-gray-800,
                    #reglamentDetailModal .bg-white.dark\:bg-gray-800,
                    #bookmarkDetailModal .bg-white.dark\:bg-gray-800,
                    #extLinkModal .bg-white.dark\:bg-gray-800
                ) {
                background-color: var(--color-surface-2) !important;
            }

            .reglament-category {
                background-color: var(--color-surface-2) !important;
            }

            /* --- ГРАНИЦЫ И РАЗДЕЛИТЕЛИ --- */
            body.custom-background-active
                :is(
                    .border,
                    .border-t,
                    .border-r,
                    .border-b,
                    .border-l,
                    .border-gray-200,
                    .border-gray-300,
                    .dark\:border-gray-600,
                    .dark\:border-gray-700,
                    .dark\:border-slate-500,
                    .dark\:border-slate-600,
                    .divide-y > :not([hidden]) ~ :not([hidden]),
                    .divide-x > :not([hidden]) ~ :not([hidden]),
                    .google-doc-table th,
                    .google-doc-table td
                ) {
                border-color: var(--color-border) !important;
            }

            body.custom-background-active :is(.h-px.bg-gray-200, .h-px.dark\:bg-gray-700) {
                background-color: var(--color-border) !important;
            }
            body.custom-background-active :is(.bg-gray-200, .dark\:bg-slate-600) {
                background-color: var(--color-surface-1) !important;
            }

            /* --- ФОРМЫ (INPUT, TEXTAREA, SELECT) --- */
            body.custom-background-active :is(input, textarea, select) {
                background-color: var(--color-input-bg) !important;
                color: var(--color-text-primary) !important;
                border-color: var(--color-border-interactive) !important;
            }

            body.custom-background-active ::-webkit-input-placeholder {
                color: var(--color-text-secondary) !important;
                opacity: 1 !important;
            }

            body.custom-background-active ::-moz-placeholder {
                color: var(--color-text-secondary) !important;
                opacity: 1 !important;
            }

            body.custom-background-active :-ms-input-placeholder {
                color: var(--color-text-secondary) !important;
                opacity: 1 !important;
            }

            body.custom-background-active ::placeholder {
                color: var(--color-text-secondary) !important;
                opacity: 1 !important;
            }

            /* --- КНОПКИ --- */
            /* 1. Основные кнопки */
            body.custom-background-active
                :is(
                    #editSedoTypesBtn,
                    #addBlacklistEntryBtn,
                    #force-refresh-shablony-btn,
                    #saveAlgorithmBtn,
                    #saveNewAlgorithmBtn,
                    #saveCibLinkBtn,
                    #addProgramAlgorithmBtn,
                    #addSkziAlgorithmBtn,
                    #addLk1cAlgorithmBtn,
                    #addWebRegAlgorithmBtn,
                    #addLinkBtn,
                    #addReglamentBtn,
                    #addBookmarkBtn,
                    #organizeBookmarksBtn,
                    #addExtLinkBtn,
                    #saveUISettingsBtn,
                    #sedoMainEditButton,
                    #editMainBtn,
                    button.bg-primary,
                    button:not([class*='bg-gray']):not([class*='bg-red']):not(
                            [class*='bg-transparent']
                        ):not(.tab-btn):not(.view-toggle):not(#timerDisplay button):not(
                            .btn-destructive
                        )
                ) {
                background-color: var(--color-primary);
                color: var(--color-text-primary) !important;
                box-shadow: none !important;
                transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            }

            /* Правило-гарант для иконок и вложенных элементов. */
            body.custom-background-active
                :is(
                    #editSedoTypesBtn,
                    #addBlacklistEntryBtn,
                    #force-refresh-shablony-btn,
                    #saveAlgorithmBtn,
                    #saveNewAlgorithmBtn,
                    #saveCibLinkBtn,
                    #addProgramAlgorithmBtn,
                    #addSkziAlgorithmBtn,
                    #addLk1cAlgorithmBtn,
                    #addWebRegAlgorithmBtn,
                    #addLinkBtn,
                    #addReglamentBtn,
                    #addBookmarkBtn,
                    #organizeBookmarksBtn,
                    #addExtLinkBtn,
                    #saveUISettingsBtn,
                    #sedoMainEditButton,
                    #editMainBtn,
                    button.bg-primary,
                    button:not([class*='bg-gray']):not([class*='bg-red']):not(
                            [class*='bg-transparent']
                        ):not(.tab-btn):not(.view-toggle):not(#timerDisplay button):not(
                            .btn-destructive
                        )
                )
                > * {
                color: var(--color-text-primary) !important;
                transition: color 0.2s ease-in-out;
            }

            body.custom-background-active
                :is(
                    #editSedoTypesBtn,
                    #addBlacklistEntryBtn,
                    #force-refresh-shablony-btn,
                    #saveAlgorithmBtn,
                    #saveNewAlgorithmBtn,
                    #saveCibLinkBtn,
                    #addProgramAlgorithmBtn,
                    #addSkziAlgorithmBtn,
                    #addLk1cAlgorithmBtn,
                    #addWebRegAlgorithmBtn,
                    #addLinkBtn,
                    #addReglamentBtn,
                    #addBookmarkBtn,
                    #organizeBookmarksBtn,
                    #addExtLinkBtn,
                    #saveUISettingsBtn,
                    #sedoMainEditButton,
                    #editMainBtn,
                    button.bg-primary,
                    button:not([class*='bg-gray']):not([class*='bg-red']):not(
                            [class*='bg-transparent']
                        ):not(.tab-btn):not(.view-toggle):not(#timerDisplay button):not(
                            .btn-destructive
                        )
                ):hover {
                background-color: var(--color-primary) !important;
                color: white !important;
            }

            #clearClientDataBtn {
                background-color: var(--color-surface-2) !important;
                border: 1px solid var(--color-border) !important;
                color: var(--color-text-primary) !important;
                box-shadow: none !important;
            }
            #clearClientDataBtn > * {
                color: var(--color-text-primary) !important;
            }
            #clearClientDataBtn:hover {
                background-color: var(--color-hover-subtle) !important;
                transition: background-color ease 0.3s;
            }

            /* Primary: Сохранить .txt */
            #exportTextBtn {
                background-color: var(--color-primary) !important;
                color: var(--color-text-primary) !important;
                border: none !important; /* гасим border-b из классов */
                box-shadow: none !important;
                transition: background-color ease 0.3s;
            }
            #exportTextBtn > * {
                color: var(--color-text-primary) !important;
            }
            #exportTextBtn:hover {
                background-color: var(--color-primary-hover) !important;
            }

            #resetUiBtn {
                background-color: var(--color-red-hover-bg);
                transition: background-color ease 0.3s;
            }

            #resetUiBtn:hover {
                background-color: rgba(220, 38, 38, 0.15);
                transition: background-color ease 0.3s;
            }

            #clearAllDataBtn {
                background-color: rgba(220, 38, 38, 0.25);
                padding: 0 1rem;
                border: 1px solid var(--color-red-text);
                transition: background-color ease 0.3s, border-color ease 0.3s;
            }

            #clearAllDataBtn:hover {
                background-color: #ef4444;
                border-color: var(--color-red-text);
                transition: background-color ease 0.3s, border-color ease 0.3s;
            }

            #confirmAndClearDataBtn {
                background-color: red;
            }

            body.custom-background-active
                :is(
                    #editSedoTypesBtn,
                    #addBlacklistEntryBtn,
                    #force-refresh-shablony-btn,
                    #saveAlgorithmBtn,
                    #saveNewAlgorithmBtn,
                    #saveCibLinkBtn,
                    #addProgramAlgorithmBtn,
                    #addSkziAlgorithmBtn,
                    #addLk1cAlgorithmBtn,
                    #addWebRegAlgorithmBtn,
                    #addLinkBtn,
                    #addReglamentBtn,
                    #addBookmarkBtn,
                    #organizeBookmarksBtn,
                    #addExtLinkBtn,
                    #saveUISettingsBtn,
                    #sedoMainEditButton,
                    #editMainBtn,
                    button.bg-primary,
                    button:not([class*='bg-gray']):not([class*='bg-red']):not(
                            [class*='bg-transparent']
                        ):not(.tab-btn):not(.view-toggle):not(#timerDisplay button):not(
                            .btn-destructive
                        )
                ):hover
                > * {
                color: white !important;
            }

            /* 2. Второстепенные кнопки (Secondary Actions) - логика не меняется. */
            body.custom-background-active button:is(.bg-gray-200, .bg-gray-300, .bg-gray-100) {
                background-color: var(--color-surface-1) !important;
                color: var(--color-text-primary) !important;
                box-shadow: none !important;
            }

            body.custom-background-active
                button:is(.bg-gray-200, .bg-gray-300, .bg-gray-100):hover {
                background-color: var(--color-hover-subtle) !important;
            }

            /* 3. Опасные/Разрушительные кнопки (Destructive Actions) - ИСКЛЮЧЕНИЕ ИЗ ПРАВИЛ. */
            body.custom-background-active .btn-destructive,
            body.custom-background-active .btn-destructive > * {
                color: var(--color-red-text) !important;
            }

            body.custom-background-active .btn-destructive {
                background-color: transparent !important;
                border: 1px solid var(--color-red-border) !important;
                box-shadow: none !important;
                padding: 0.5rem 1rem;
            }

            body.custom-background-active .btn-destructive:hover {
                background-color: var(--color-red-hover-bg) !important;
                border-color: var(--color-red-text) !important;
            }

            .btn-destructive-all,
            .btn-destructive-all > * {
                color: white !important;
                border: none !important;
            }

            /* Специфичные стили для кнопок очистки данных и сброса настроек */
            body.custom-background-active #resetUiBtn {
                background-color: var(--color-red-hover-bg) !important;
                border: 1px solid var(--color-red-border) !important;
                color: var(--color-red-text) !important;
            }

            body.custom-background-active #resetUiBtn:hover {
                background-color: rgba(220, 38, 38, 0.15) !important;
                border-color: var(--color-red-text) !important;
            }

            body.custom-background-active #clearAllDataBtn {
                background-color: rgba(220, 38, 38, 0.25) !important;
                border: 1px solid var(--color-red-text) !important;
            }

            body.custom-background-active #clearAllDataBtn:hover {
                background-color: #ef4444 !important;
                border-color: var(--color-red-text) !important;
            }

            /* ===== Спец-исключения для модалки очистки данных ===== */
            body.custom-background-active #confirmClearDataModal #clearDataWarningBox {
                background-color: #fffbeb !important;
                border-color: #fde68a !important;
                color: #92400e !important;
            }
            html.dark body.custom-background-active #confirmClearDataModal #clearDataWarningBox {
                background-color: rgba(120, 53, 15, 0.5) !important;
                border-color: #92400e !important;
                color: #fde68a !important;
            }

            body.custom-background-active
                #confirmClearDataModal
                #clearDataWarningBox
                #exportBeforeClearBtn,
            html.dark
                body.custom-background-active
                #confirmClearDataModal
                #clearDataWarningBox
                #exportBeforeClearBtn {
                background: transparent !important;
                color: inherit !important;
                border: none !important;
                text-decoration: underline !important;
            }
            body.custom-background-active
                #confirmClearDataModal
                #clearDataWarningBox
                #exportBeforeClearBtn:hover {
                color: #7c2d12 !important;
            }
            html.dark
                body.custom-background-active
                #confirmClearDataModal
                #clearDataWarningBox
                #exportBeforeClearBtn:hover {
                color: #fde68a !important;
            }
            body.custom-background-active
                #confirmClearDataModal
                :is(h2 .fa-exclamation-triangle, .text-red-600, .dark\:text-red-500) {
                color: var(--color-red-text, #dc2626) !important;
            }
            body.custom-background-active #confirmClearDataModal #confirmAndClearDataBtn {
                background-color: var(--color-red-text, #dc2626) !important;
                color: #fff !important;
                border-color: var(--color-red-text, #dc2626) !important;
            }
            body.custom-background-active #confirmClearDataModal #confirmAndClearDataBtn:hover {
                background-color: var(--color-red-hover-bg, #ef4444) !important;
                border-color: var(--color-red-text, #dc2626) !important;
            }
            body.custom-background-active #confirmClearDataModal #cancelClearDataBtn {
                background-color: #e5e7eb !important;
                color: #374151 !important;
                border-color: #d1d5db !important;
            }
            html.dark body.custom-background-active #confirmClearDataModal #cancelClearDataBtn {
                background-color: #374151 !important;
                color: #e5e7eb !important;
                border-color: #4b5563 !important;
            }
            body.custom-background-active #confirmClearDataModal .bg-gray-50 {
                background-color: #f9fafb !important;
            }
            html.dark body.custom-background-active #confirmClearDataModal .dark\:bg-gray-700 {
                background-color: #374151 !important;
            }

            /* --- ССЫЛКИ --- */
            /* Правило для заголовков и элементов, которые не являются ссылками, но используют акцентный цвет */
            body.custom-background-active .text-primary {
                color: var(--color-primary) !important;
            }

            /* Правило для настоящих ссылок <a> */
            body.custom-background-active #appContent a {
                color: var(--color-text-primary) !important;
                text-decoration: underline !important;
                text-underline-offset: 3px;
                text-decoration-color: var(--color-primary) !important;
                transition: color 0.2s ease-in-out, text-decoration-color 0.2s ease-in-out;
            }

            body.custom-background-active #appContent a:hover {
                color: var(--color-primary) !important;
                text-decoration-color: var(--color-secondary) !important;
            }

            /* --- ТЕГИ И УВЕДОМЛЕНИЯ (ALERTS) --- */
            /* Адаптивные теги/метки */
            body.custom-background-active
                :is(
                    .bg-green-100,
                    .bg-yellow-100,
                    .bg-red-100,
                    .bg-blue-100,
                    .bg-purple-100,
                    .bg-indigo-100,
                    .bg-pink-100,
                    .bg-orange-100,
                    .bg-teal-100,
                    .bg-cyan-100,
                    .bg-amber-100,
                    .bg-lime-100,
                    .bg-emerald-100,
                    .bg-sky-100,
                    .dark\:bg-green-900,
                    .dark\:bg-yellow-900,
                    .dark\:bg-red-900,
                    .dark\:bg-blue-900,
                    .dark\:bg-purple-900,
                    .dark\:bg-indigo-900,
                    .dark\:bg-pink-900,
                    .dark\:bg-orange-900,
                    .dark\:bg-teal-900,
                    .dark\:bg-cyan-900,
                    .dark\:bg-amber-900,
                    .dark\:bg-lime-900,
                    .dark\:bg-emerald-900,
                    .dark\:bg-sky-900
                ) {
                background-color: var(--color-surface-1) !important;
                border: 1px solid var(--color-border) !important;
            }

            body.custom-background-active
                :is(
                    .text-green-800,
                    .text-yellow-800,
                    .text-red-800,
                    .text-blue-800,
                    .text-purple-800,
                    .text-indigo-800,
                    .text-pink-800,
                    .text-orange-800,
                    .text-teal-800,
                    .text-cyan-800,
                    .text-amber-800,
                    .text-lime-800,
                    .text-emerald-800,
                    .text-sky-800,
                    .dark\:text-green-200,
                    .dark\:text-yellow-200,
                    .dark\:text-red-200,
                    .dark\:text-blue-200,
                    .dark\:text-purple-200,
                    .dark\:text-indigo-200,
                    .dark\:text-pink-200,
                    .dark\:text-orange-200,
                    .dark\:text-teal-200,
                    .dark\:text-cyan-200,
                    .dark\:text-amber-200,
                    .dark\:text-lime-200,
                    .dark\:text-emerald-200,
                    .dark\:text-sky-200
                ) {
                color: var(--color-text-secondary) !important;
            }

            /* Адаптивные информационные панели (Alerts) */
            body.custom-background-active
                :is(
                    .bg-blue-50,
                    .dark\:bg-blue-900\/50,
                    .bg-yellow-50,
                    .dark\:bg-yellow-900\/50,
                    .bg-green-50,
                    .bg-red-50
                ) {
                background-color: var(--color-surface-2) !important;
                border-left-width: 4px;
            }

            body.custom-background-active
                :is(
                    .text-blue-800,
                    .dark\:text-blue-200,
                    .text-yellow-800,
                    .dark\:text-yellow-200,
                    .text-green-800,
                    .text-red-800
                ) {
                color: var(--color-text-primary) !important;
            }

            /* --- СПЕЦИФИЧЕСКИЕ КОМПОНЕНТЫ --- */
            /* Hover для блоков в "Шаблонах" */
            body.custom-background-active .shablony-block.copyable-block:hover {
                background-color: var(--color-hover-subtle) !important;
            }

            body.custom-background-active :is(nav, div):has(> .tab-btn) {
                background-color: transparent !important;
                box-shadow: none !important;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2) !important;
            }
            
            body.custom-background-active .tab-btn {
                color: #B0B0B0 !important;
            }
            
            body.custom-background-active .tab-btn i,
            body.custom-background-active .tab-btn svg {
                color: #B0B0B0 !important;
            }
            
            body.custom-background-active .tab-btn:hover:not(.tab-active) {
                color: #B0B0B0 !important;
            }

            body.custom-background-active .tab-btn:hover:not(.tab-active) i,
            body.custom-background-active .tab-btn:hover:not(.tab-active) svg {
                color: #B0B0B0 !important;
            }

            body.custom-background-active .tab-btn.tab-active:hover {
                color: #9955FF !important;
                border-bottom-color: #9955FF !important;
            }

            body.custom-background-active .tab-btn.tab-active:hover i,
            body.custom-background-active .tab-btn.tab-active:hover svg {
                color: #9955FF !important;
            }

            body.custom-background-active .force-transparent {
                background: transparent !important;
                background-color: transparent !important;
                box-shadow: none !important;
                border: none !important;
            }

            body.custom-background-active
                #customizeUIModal
                .p-content
                > div[class*='space-y']
                > div {
                background-color: transparent !important;
                box-shadow: none !important;
            }

            /* ---------------------------------------------------- */
            /*      3.3. Кастомное фоновое изображение              */
            /* ---------------------------------------------------- */
            body.custom-bg-image-active::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                z-index: -1;
                background-image: var(--custom-background-image);
                background-size: contain;
                background-position: center center;
                background-repeat: no-repeat;
                background-attachment: fixed;
                background-color: var(--color-background);
            }

            body.custom-bg-image-active.theme-light-text::before {
                filter: brightness(0.6);
            }

            body.custom-bg-image-active.theme-dark-text::before {
                filter: brightness(1.5) contrast(0.9);
            }

            body.custom-bg-image-active {
                background-color: transparent !important;
            }

            #backgroundImagePreview {
                width: 128px;
                height: 72px;
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
            }

            body.custom-background-active
                #customizeUIModal
                .p-content
                button:not(#saveUISettingsBtn):not(.btn-destructive) {
                background: transparent !important;
                background-color: transparent !important;
                box-shadow: none !important;
            }

            /* =================================================================== */
            /*           IV. УТИЛИТЫ И АНИМАЦИИ (Utilities & Animations)         */
            /* =================================================================== */

            /* ----------------------------------- */
            /*           4.1. Анимации             */
            /* ----------------------------------- */
            @keyframes pulse-highlight {
                0% {
                    transform: scale(1);
                    box-shadow: 0 0 0 0 rgba(255, 180, 50, 0.4);
                }

                50% {
                    transform: scale(1.01);
                    box-shadow: 0 0 3px 6px rgba(255, 180, 50, 0);
                }

                100% {
                    transform: scale(1);
                    box-shadow: 0 0 0 0 rgba(255, 180, 50, 0);
                }
            }

            .search-highlight-pulse {
                animation: pulse-highlight 1.3s ease-in-out;
            }

            @keyframes shake {
                10%,
                90% {
                    transform: translate3d(-1px, 0, 0);
                }

                20%,
                80% {
                    transform: translate3d(2px, 0, 0);
                }

                30%,
                50%,
                70% {
                    transform: translate3d(-4px, 0, 0);
                }

                40%,
                60% {
                    transform: translate3d(4px, 0, 0);
                }
            }

            .notification-updated-shake {
                animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
                transform: translate3d(0, 0, 0);
            }

            /* ----------------------------------- */
            /*        4.2. Вспомогательные классы  */
            /* ----------------------------------- */
            #appContent.content-hidden-initial {
                opacity: 0;
                visibility: hidden;
            }

            #appContent.content-fading-in {
                opacity: 1;
                visibility: visible;
                transition: opacity 0.6s ease-in;
            }

            /* ----------------------------------- */
            /*             4.3. Копирайт           */
            /* ----------------------------------- */
            #app-copyright {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial,
                    sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
                color: #9ca3af;
                background-color: transparent;
                z-index: 10;
                transition: color 0.2s ease-in-out;
                padding-bottom: calc(0.5rem + env(safe-area-inset-bottom));
            }

            .dark #app-copyright {
                color: #4b5563;
            }

            #app-copyright a {
                color: inherit;
                text-decoration: none;
            }

            #app-copyright a:hover {
                text-decoration: underline;
                color: var(--color-primary, #5d5cde);
            }

            /* Обеспечиваем одинаковый цвет для заголовка Copilot и подзаголовка */
            header h1.text-primary,
            header #appSlogan.text-primary,
            html.dark header h1.text-primary,
            html.dark header #appSlogan.text-primary,
            body.custom-background-active header h1.text-primary,
            body.custom-background-active header #appSlogan.text-primary,
            html.dark body.custom-background-active header h1.text-primary,
            html.dark body.custom-background-active header #appSlogan.text-primary {
                color: var(--color-primary) !important;
            }

            #showFavoritesHeaderBtn,
            #timerToggleButton,
            #timerResetButton,
            #timerDecreaseButton,
            #timerIncreaseButton,
            #themeToggle,
            #exportDataBtn,
            #importDataBtn,
            #forceReloadBtn,
            #showHotkeysBtn {
                color: var(--color-primary) !important;
            }
            #showFavoritesHeaderBtn i,
            #timerToggleButton i,
            #timerResetButton i,
            #timerDecreaseButton i,
            #timerIncreaseButton i,
            #themeToggle i,
            #exportDataBtn i,
            #importDataBtn i,
            #forceReloadBtn i,
            #showHotkeysBtn i {
                color: var(--color-primary) !important;
            }

            #editMainBtn,
            #editMainBtn > * {
                background-color: var(--color-primary) !important;
                color: var(--color-text-primary) !important;
            }

            :root:not(.dark) {
                --color-primary-hover: var(--color-secondary);
            }
            html.dark,
            :root.dark {
                --color-primary-hover: var(--color-secondary);
            }

            @supports (color: color-mix(in srgb, white, black)) {
                :root:not(.dark) {
                    --color-primary-hover: color-mix(in srgb, var(--color-primary) 80%, black);
                }
                html.dark,
                :root.dark {
                    --color-primary-hover: color-mix(in srgb, var(--color-primary) 80%, white);
                }
            }

            html:not(.dark) [class~='bg-primary']:hover,
            html.dark [class~='bg-primary']:hover {
                background-color: var(--color-primary-hover) !important;
            }

            /* ========================= Elevation / Тени уровней ========================= */
            /* Светлая тема: более насыщённые тени */
            :root:not(.dark) {
                --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.18), 0 0 0 1px rgba(0, 0, 0, 0.06);
                --shadow-md: 0 8px 16px rgba(0, 0, 0, 0.18), 0 2px 3px rgba(0, 0, 0, 0.12),
                    0 0 0 1px rgba(0, 0, 0, 0.05);
                --shadow-lg: 0 12px 24px rgba(0, 0, 0, 0.22), 0 6px 5px rgba(0, 0, 0, 0.14),
                    0 0 0 1px rgba(0, 0, 0, 0.04);
                --shadow-xl: 0 24px 48px rgba(0, 0, 0, 0.25), 0 12px 10px rgba(0, 0, 0, 0.16);
            }
            /* Тёмная тема: глубже тени + тонкий светлый контур для отделения от фона */
            html.dark,
            :root.dark {
                --shadow-sm: 0 1px 4px rgba(0, 0, 0, 0.463), 0 0 0 1px rgba(255, 255, 255, 0.08);
                --shadow-md: 0 8px 18px rgba(0, 0, 0, 0.3), 0 2px 15px rgba(0, 0, 0, 0.3),
                    0 0 0 1px rgba(255, 255, 255, 0.06);
                --shadow-lg: 0 14px 18px rgba(0, 0, 0, 0.486), 0 6px 14px rgba(0, 0, 0, 0.453),
                    0 0 0 1px rgba(255, 255, 255, 0.05);
                --shadow-xl: 0 28px 6px rgba(0, 0, 0, 0.5), 0 14px 8px rgba(0, 0, 0, 0.44),
                    0 0 0 1px rgba(255, 255, 255, 0.04);
            }
            /* Переопределяем стандартные shadow-классы Tailwind на семантические значения */
            .shadow-sm {
                box-shadow: var(--shadow-sm) !important;
            }
            .shadow-md {
                box-shadow: var(--shadow-md) !important;
            }
            .shadow-lg {
                box-shadow: var(--shadow-lg) !important;
            }
            .shadow-xl {
                box-shadow: var(--shadow-xl) !important;
            }

            .pdf-drop-overlay {
                padding: 8px;
                box-sizing: border-box;
                display: grid;
                place-items: center;
            }
            .pdf-drop-overlay .pdf-drop-msg {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                max-width: calc(100% - 16px);
                text-align: center;
                white-space: normal;
                word-break: break-word;
                overflow-wrap: anywhere;
                line-height: 1.2;
                font-size: clamp(10px, 1.8vw, 14px);
            }

            /*Прочие стили*/
            .bookmark-item.view-item {
                margin-block: 2px;
            }

            /* Убираем темный фон и левую линию у блоков "Пример" */
            .example-container {
                background-color: transparent !important;
                border-left: none !important;
            }

            /* Убираем темный фон и левую линию у всех элементов с классами bg-gray и border-l */
            div.mt-2.p-2.bg-gray-50,
            div.mt-2.p-2.dark\:bg-gray-800,
            div.mt-2.p-2.border-l-4,
            div.mt-2.p-2.border-l-4.border-gray-400,
            div.mt-2.p-2.rounded.border-l-4 {
                background-color: transparent !important;
                border-left: none !important;
            }

            /* Убираем темный фон и левую линию у блоков примеров через селектор по содержимому */
            div.mt-2.p-2:has(> strong) {
                background-color: transparent !important;
                border-left: none !important;
            }
        